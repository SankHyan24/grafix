---
title: GAMES101 16 Ray Tracing 4 Path Tracing
date: 2022-01-16 11:15:48
tags: Graphics 
cover: https://s2.loli.net/2022/01/05/8YXeMtP9g1HrcTJ.jpg
mathjax: true
categories: GAMES101
---

# Ray Tracing 4 Path Tracing
## Monte Carlo Integration
- Definite intergral: $\int_{a}^{b}{f(x)dx}$
- Random variable: $X_i\sim pdf(x)$ , pdf is the Probability Distribution Function
- Monte Carlo estimator: $F_N=\frac{1}{N}\sum_{i=1}^{N}{\frac{f(x_i)}{pdf(x_i)}}$

我自己证明一下：中心极限定理，当 $ N\rightarrow \infin $ 
$$
\begin{align*}
\frac{1}{N}\sum_{i=1}^{N}{\frac{f(x_i)}{pdf(x_i)}}&\rightarrow E(\frac{f(x_i)}{pdf(x_i)}) \\
&= \int_{a}^{b}{pdf(x_i)\times \frac{f(x_i)}{pdf(x_i)}}dx\\
&=\int_{a}^{b}{f(x_i)}dx\\
&= F_N|_{a}^{b}
\end{align*}
$$
$F_N|_{a}^{b}$大概就是$x$从$a$到$b$的面积了
## Path Tracing
### Whitted-Style Ray Tracing:
- Always perform specular reflections / refractions
- Stop bouncing at diffuse surfaces
- Problems:
    1. Can't solve "glossy" surface well - Utah teapot
    2. No reflections between diffuse materials. should contains color bleeding - The Cornell box
    3. Whitted-Style Ray Tracing is Wrong! But the rendering function is correct
### A Simple Monte Carlo Solution:
- 对于一个点，就是把四面八方进来的光合起来（这里对方向进行采样，进行蒙特卡罗积分），然后算出射到眼睛点的光。
- 最简单的办法，均匀采样， $p(\omega_i)=1/2\pi$
- 得到方程 $ L_o(p,\omega_o)\approx\frac{1}{N}\sum_{i=1}^{N}{\frac{L_i(p,\omega_i)f_r(p,\omega_i,\omega_o)(n\cdot \omega_i)}{p(\omega_i)}} $
### Introducing Global Illumination 全局光照
- 就是在每个点的光源里面加上其他点的光，其他点的光怎么求？递归调用。
- 但是这么算会出现光线爆炸，光线指数级别增长，内存也炸了。
- 唯一不爆炸的办法就是每次取样只取样一束外来光线。形成一条光线的路径，所以也叫路径追踪。